/**
 * @package
 * @subpackage organizer
 * @copyright 2020 Thomas Niedermaier (thomas.niedermaier@gmail.com)
 * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_organizer/initinfobox",["jquery","core/config"],(function($,config){var instance=new function(){this.studentview=0,this.registrationview=0,this.userid=0};return instance.init=function(studentview,registrationview,userid){function toggle_all_slots(event){null!=event&&0==instance.registrationview&&saveuserpreference();var tablebody=$("#slot_overview tbody"),showpastslots=$("#show_past_slots").is(":checked"),showmyslotsonly=$("#show_my_slots_only").is(":checked"),showfreeslotsonly=$("#show_free_slots_only").is(":checked"),showhiddenslots=$("#show_hidden_slots").is(":checked"),showregistrationsonly=$("#show_registrations_only").is(":checked");tablebody.find("tr").show(),null!=event?showregistrationsonly?($("#show_registrations_only").is(event.target)&&($("#show_free_slots_only").prop("checked",!1),showfreeslotsonly=!1,saveuserpreference()),showfreeslotsonly?$("#show_free_slots_only").is(event.target)?($("#show_registrations_only").prop("checked",!1),tablebody.find("tr.not_free_slot").hide(),saveuserpreference()):($("#show_free_slots_only").prop("checked",!1),tablebody.find("tr.not_registered").hide(),saveuserpreference()):tablebody.find("tr.not_registered").hide()):showfreeslotsonly&&tablebody.find("tr.not_free_slot").hide():showregistrationsonly&&showfreeslotsonly?($("#show_free_slots_only").prop("checked",!1),tablebody.find("tr.not_registered").hide(),saveuserpreference()):showregistrationsonly?tablebody.find("tr.not_registered").hide():showfreeslotsonly&&tablebody.find("tr.not_free_slot").hide(),instance.studentview||showhiddenslots||tablebody.find("tr.unavailable").hide(),showpastslots||tablebody.find("tr.past_due").hide(),showmyslotsonly&&(instance.studentview||tablebody.find("tr.not_my_slot").hide());var target=$(".organizer_filtertable");if(target){var filter=target.val().toUpperCase();if(filter){var i,j,td,text,found,tr=tablebody.find("tr:visible:not(.info)");for(i=0;i<tr.length;i++){if(found=!1,td=tr[i].getElementsByTagName("td"))for(j=0;j<td.length;j++)if((text=extracttext(td[j]))&&text.toUpperCase().indexOf(filter)>-1){found=!0;break}found||$(tr[i]).hide()}}}tablebody.show(),$("#counttabrows").text(tablebody.find("tr:visible:not(.info)").length),function(){var tablebody=$("#slot_overview tbody"),noninforows=tablebody.find("tr:not(.info)"),noneexist=0===noninforows.length,anyvisible=!1;noninforows.each((function(){"none"!==$(this).css("display")&&(anyvisible=!0)}));var showpastslots=$("#show_past_slots").is(":checked"),showmyslotsonly=$("#show_my_slots_only").is(":checked");tablebody.find("tr.info").hide(),anyvisible||(noneexist?tablebody.find("tr.no_slots_defined").show():showpastslots&&!showmyslotsonly?tablebody.find("tr.no_slots").show():showpastslots&&showmyslotsonly?tablebody.find("tr.no_my_slots").show():tablebody.find("tr.no_due_slots").show())}()}function extracttext(element){var text,last;if(!(text=(last=$(element).clone().find("script,style").remove().end()).text())){var attr=last.find("img:not(.icon)").first().attr("alt");void 0!==attr&&!1!==attr&&(text=attr)}return text}function saveuserpreference(){let slotsviewoptions="";slotsviewoptions+=$("#show_my_slots_only").is(":checked")?"1":"0",slotsviewoptions+=$("#show_free_slots_only").is(":checked")?"1":"0",slotsviewoptions+=$("#show_hidden_slots").is(":checked")?"1":"0",slotsviewoptions+=$("#show_past_slots").is(":checked")?"1":"0",slotsviewoptions+=$("#show_registrations_only").is(":checked")?"1":"0",slotsviewoptions+=$("#show_all_participants").is(":checked")?"1":"0",$.get(config.wwwroot+"/mod/organizer/slotsviewoptions.php",{sesskey:config.sesskey,slotsviewoptions:encodeURI(slotsviewoptions),userid:instance.userid},"json")}function participantslists_all_toggle(){0==instance.registrationview&&saveuserpreference();let tablebody=$("#slot_overview tbody");if(1==$("#show_all_participants").is(":checked")){$(".mycollapse").show(),tablebody.find(".collapseicon").each((function(){let isrc=$(this).attr("src");isrc=isrc.replace("plus-square","minus-square"),$(this).attr("src",isrc)}))}else{$(".mycollapse").hide(),tablebody.find(".collapseicon").each((function(){let isrc=$(this).attr("src");isrc=isrc.replace("minus-square","plus-square"),$(this).attr("src",isrc)}))}}instance.studentview=studentview,instance.registrationview=registrationview,instance.userid=userid,$("#show_past_slots").on("click",(function(){toggle_all_slots(event)})),$("#show_all_participants").on("click",(function(){participantslists_all_toggle()})),$("#show_my_slots_only").on("click",(function(){toggle_all_slots(event)})),$("#show_free_slots_only").on("click",(function(){toggle_all_slots(event)})),$("#show_hidden_slots").on("click",(function(){toggle_all_slots(event)})),$("#show_registrations_only").on("click",(function(){toggle_all_slots(event)})),$(".organizer_filtertable").on("keyup",(function(){toggle_all_slots(event)})),$(".collapseclick").on("click",(function(){!function(target){let clickeddiv=$(target).parent(),targetclass=clickeddiv.attr("data-target");$(targetclass).toggle();let icon=clickeddiv.find(".collapseicon"),isrc=$(icon).attr("src");isrc=isrc.indexOf("minus-square")>0?isrc.replace("minus-square","plus-square"):isrc.replace("plus-square","minus-square"),$(icon).attr("src",isrc)}(event.target)})),toggle_all_slots(),participantslists_all_toggle(),$(".organizer_filtertable").keypress((function(event){if("13"==(event.which?event.which:event.keyCode))return!1}))},instance}));

//# sourceMappingURL=initinfobox.min.js.map