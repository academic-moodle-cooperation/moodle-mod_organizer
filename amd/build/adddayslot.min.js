/**
 * @package
 * @subpackage organizer
 * @copyright 2020 Thomas Niedermaier (thomas.niedermaier@gmail.com)
 * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_organizer/adddayslot",["jquery"],(function($){var instance=new function(){this.totalslots=0,this.displayallslots=0,this.totalday="",this.totaltotal="",this.current="0"};return instance.init=function(param){if(instance.totalslots=param.totalslots,instance.displayallslots=param.displayallslots,instance.totalday=param.totalday,instance.totaltotal=param.totaltotal,instance.relativedeadline=param.relativedeadline,instance.relativedeadlinestring=param.relativedeadlinestring,instance.allowcreationofpasttimeslots=param.allowcreationofpasttimeslots,instance.pasttimeslotsstring=param.pasttimeslotsstring,0==instance.displayallslots){for(var i=instance.totalslots-1;i>0&&-1==$("#id_newslots_"+String(i)+"_day").val();i--)$("#id_newslots_"+String(i)+"_day").closest(".form-group.row.fitem").hide(),$("#fgroup_id_slotgroup"+String(i)).hide();i<instance.totalslots-1&&$("#id_addday").hide()}else instance.current=instance.totalslots,evaluateallrows();function evaluaterow(i){var howmanyslots=function(i){var dayfromvalue=parseInt($("select[name^='newslots["+i+"][day]']").val());if(-1==dayfromvalue)return[0,0,0];var daytovalue=parseInt($("select[name^='newslots["+i+"][dayto]']").val());if(-1==daytovalue)return[0,0,0];var daydate,jsdaydate,datefrom,dateto,itime,periodstartdate=getstartdate(),periodenddate=getenddate(),valfrom=parseInt($("select[name='newslots["+i+"][fromh]']").val())+parseInt($("select[name='newslots["+i+"][fromm]']").val()),valto=parseInt($("select[name='newslots["+i+"][toh]']").val())+parseInt($("select[name='newslots["+i+"][tom]']").val()),duration=getduration(),iteration=duration+function(){var gapnumber=parseInt($("input[name='gap[number]']").val()),gaptimeunit=parseInt($("select[name='gap[timeunit]']").val());isNaN(gapnumber)&&(gapnumber=0);return gapnumber*gaptimeunit}(),slots=0,slotsnotcreatedduetodeadline=0,slotsnotcreatedduetopasttime=0;for(daydate=periodstartdate;daydate<=periodenddate;daydate=addDays(1e3*daydate,1))if(dayfromvalue==((jsdaydate=new Date(1e3*daydate)).getDay()?jsdaydate.getDay()-1:6)){for(datefrom=daydate+valfrom,dateto=daydate+86400*(daytovalue-dayfromvalue)+valto;dateto<datefrom;)dateto+=604800;if(!(datefrom<periodstartdate||datefrom>periodenddate)){var date=(new Date).getTime()/1e3;for(dateto=periodenddate<dateto?periodenddate:dateto,itime=datefrom;itime+duration<=dateto;itime+=iteration)itime-date<instance.relativedeadline&&itime-date>0?slotsnotcreatedduetodeadline++:itime-date<0&&0==instance.allowcreationofpasttimeslots?slotsnotcreatedduetopasttime++:slots++}}return[slots,slotsnotcreatedduetodeadline,slotsnotcreatedduetopasttime]}(i),slots=howmanyslots[0],slotsnotcreatedduetodeadline=howmanyslots[1],slotsnotcreatedduetopasttime=howmanyslots[2],pax=function(){var pax=$("input[name=maxparticipants]").val();return $.isNumeric(pax)?pax:0}();pax*=slots;var forecaststring=instance.totalday.replace("xxx",slots.toString()).replace("yyy",pax.toString());slotsnotcreatedduetodeadline>0&&(forecaststring+=" ("+instance.relativedeadlinestring.replace("xxx",slotsnotcreatedduetodeadline.toString())+")"),slotsnotcreatedduetopasttime>0&&(forecaststring+=" ("+instance.pasttimeslotsstring.replace("xxx",slotsnotcreatedduetopasttime.toString())+")"),$("span[name='forecastday_"+i+"']").html(forecaststring),$("span[name='newslots_"+i+"']").html(slots.toString()),$("span[name='newpax_"+i+"']").html(pax.toString())}function evaluateallrows(){for(var i=0;i<instance.current;i++)evaluaterow(i);writetotal()}function writetotal(){var totalslots=0,totalpax=0;$("span[name^='newslots_']").each((function(){var slots=parseInt($(this).html());0==isNaN(slots)&&(totalslots+=slots)})),$("span[name^='newpax_']").each((function(){var pax=parseInt($(this).html());0==isNaN(pax)&&(totalpax+=pax)}));var forecaststring=instance.totaltotal.replace("xxx",totalslots.toString()).replace("yyy",totalpax.toString());$("div[name='organizer_newslots_forecasttotal']").html(forecaststring)}function getstartdate(){var startdateday=$("select[name='startdate[day]']").val(),startdatemonth=$("select[name='startdate[month]']").val()-1,startdateyear=$("select[name='startdate[year]']").val();return new Date(startdateyear,startdatemonth,startdateday).getTime()/1e3}function getenddate(){var enddateday=$("select[name='enddate[day]']").val(),enddatemonth=$("select[name='enddate[month]']").val()-1,enddateyear=$("select[name='enddate[year]']").val();return new Date(enddateyear,enddatemonth,enddateday).getTime()/1e3+86400}function getduration(){var durationnumber=parseInt($("input[name='duration[number]']").val()),durationtimeunit=parseInt($("select[name='duration[timeunit]']").val());return isNaN(durationnumber)?0:durationnumber*durationtimeunit}function addDays(date,days){var result=new Date(date);return result.setDate(result.getDate()+days),result.getTime()/1e3}$('[name^="newslots"]').not(":checkbox").on("change",(function(e){var name=$(e.target).attr("name"),i=parseInt(name.replace("newslots[","")),valdayfrom=parseInt($("select[name='newslots["+i+"][day]']").val()),valdayto=parseInt($("select[name='newslots["+i+"][dayto]']").val()),valfrom=parseInt($("select[name='newslots["+i+"][fromh]']").val())+parseInt($("select[name='newslots["+i+"][fromm]']").val());if(-1!=valdayfrom&&-1==name.indexOf("dayto")&&-1==name.indexOf("toh")&&-1==name.indexOf("tom")){for(var periodstartdate=getstartdate(),periodenddate=getenddate(),daydate=periodstartdate;daydate<=periodenddate;daydate=addDays(1e3*daydate,1)){var jsdaydate=new Date(1e3*daydate),iday=jsdaydate.getDay();if(valdayfrom==(iday?iday-1:6))break}var pdate=jsdaydate/1e3+valfrom+getduration(),jspdate=new Date(1e3*pdate),pday=jspdate.getDay(),pweekday=pday?pday-1:6;$("select[name='newslots["+i+"][dayto]']").val(pweekday),valdayto=pweekday;var hours=jspdate.getHours(),minutes=jspdate.getMinutes(),pseconds=60*(minutes=minutes%5?minutes+(5-minutes%5):minutes);$("select[name='newslots["+i+"][toh]']").val(3600*hours),$("select[name='newslots["+i+"][tom]']").val(pseconds)}-1!=valdayfrom&&-1!=valdayto?(evaluaterow(i),function(id){let nextindex=parseInt(id)+1;nextindex>instance.current&&($("#id_newslots_"+String(nextindex)+"_day").closest(".form-group.row.fitem").show(),$("#fgroup_id_slotgroup"+String(nextindex)).show(),nextindex==instance.totalslots&&$("#id_addday").show(),instance.current++)}(i)):function(i){var slots=0,pax=0,forecaststring=instance.totalday.replace("xxx",slots.toString()).replace("yyy",pax.toString());$("span[name='forecastday_"+i+"']").html(forecaststring),$("span[name='newslots_"+i+"']").html(slots.toString()),$("span[name='newpax_"+i+"']").html(pax.toString())}(i);writetotal()})),$('input[name^="duration"]').on("change",evaluateallrows),$('select[name^="duration"]').on("change",evaluateallrows),$('input[name^="gap"]').on("change",evaluateallrows),$('select[name^="gap"]').on("change",evaluateallrows),$('input[name="maxparticipants"]').on("change",evaluateallrows),$('select[name^="startdate"]').on("change",evaluateallrows),$('select[name^="enddate"]').on("change",evaluateallrows),1==$("#id_now").prop("checked")&&($("[name^=availablefrom]").prop("disabled",!0),$("#id_availablefrom_timeunit").prop("disabled",!0))},instance}));

//# sourceMappingURL=adddayslot.min.js.map