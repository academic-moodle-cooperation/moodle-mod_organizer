{"version":3,"file":"printform.min.js","sources":["../src/printform.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/.\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle. If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @package\n * @subpackage organizer\n * @copyright 2020 Thomas Niedermaier (thomas.niedermaier@gmail.com)\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * In print form: Toggle columns (show/hide).\n */\n\n\ndefine(\n    ['jquery', 'core/config', 'core/log'], function($, config, log) {\n\n        /**\n     * @constructor\n     * @alias module:mod_organizer/printform\n     */\n        var Printform = function() {\n            this.iconminus = \"\";\n            this.iconplus = \"\";\n        };\n\n        var instance = new Printform();\n\n        instance.init = function(param) {\n\n            /**\n             * Writes expand icon (+) and hide icon (-) in every header cell. Every expand icon is set to hidden.\n             */\n            function init_header() {\n                var printpreview = $('#print_preview');\n                printpreview.find('th').find('a[name$=_cell]').each(function() {\n                    var name = $(this).attr(\"name\");\n                    var col = name.split(\"_\")[0];\n                    var iconminus = instance.iconminus.replace('xxx', col + '_thiconminus').replace('yyy', col);\n                    var iconplus = instance.iconplus.replace('xxx', col + '_thiconplus').replace('yyy', col);\n                    $(this).parent().append(iconminus).append(iconplus);\n                    $('#' + col + '_thiconplus').hide();\n                });\n                var $form = $('#organizer_main_cointainer form');\n                $('input[name=\"downloadfile\"]').click(function() { $form.attr('target', '_blank'); });\n                $('input[name=\"cancel\"]').click(function() { $form.attr('target', '_self'); });\n            }\n\n            /**\n             * During initialization of the table every column which is set to hidden in the user preferences\n             * will be hidden here.\n             */\n            function init_noprints() {\n                var printpreview = $('#print_preview');\n                printpreview.find('th').find('a[noprint*=1]').each(function() {\n                    var name = $(this).attr(\"name\");\n                    var col = name.split(\"_\")[0];\n                    $('#' + col + '_thiconminus').trigger(\"click\");\n                });\n            }\n\n            /**\n             * Stores the invisible columms of the print preview table in the moodle user preferences table.\n             */\n            function set_user_preference() {\n                var name = \"mod_organizer_noprintfields\";\n                var values = \"\";\n                $(\"img[id$='_thiconplus']\").not(':hidden').each(function() {\n                    values += $(this).attr(\"col\") + ',';\n                });\n                var cfg = {\n                    method: 'get',\n                    url: config.wwwroot + '/lib/ajax/setuserpref.php',\n                    data: {\n                        'sesskey': config.sesskey,\n                        'pref': encodeURI(name),\n                        'value': encodeURI(values)\n                    },\n                    dataType: 'json',\n                    beforeSend: function() {\n                        log.info(\"set user preference \" + name + \": \" + values, \"organizer\");\n                    },\n                    success: function() {\n                        log.info(\"set user preference OK\", \"organizer\");\n                    },\n                    error: function() {\n                        log.error(\"set user preference FAILED\", \"organizer\");\n                    }\n                };\n                $.ajax(cfg);\n            }\n\n            /**\n             * Hide a former visible column or show a former hidden column here.\n             * @param {object} e the click event of the + or - icon\n             */\n            function toggle_column(e) {\n                var target = $(e.target);\n                var col = target.attr('col');\n                var src = target.attr('src');\n                var hide;\n                if (src.indexOf(\"minus\") != -1) {\n                    hide = true;\n                    $('#' + col + '_thiconminus').hide();\n                    $('#' + col + '_thiconplus').show();\n                    $('a[name=' + col + '_cell]').hide();\n                } else {\n                    hide = false;\n                    $('#' + col + '_thiconplus').hide();\n                    $('#' + col + '_thiconminus').show();\n                    $('a[name=' + col + '_cell]').show();\n                }\n                var printpreview = $('#print_preview');\n                printpreview.find('span[name=\"' + col + '_cell\"]').each(\n                    function() {\n                        if (hide) {\n                            $(this).hide();\n                        } else {\n                            $(this).show();\n                        }\n                    }\n                );\n                set_user_preference();\n            }\n\n            instance.iconminus = param.iconminus;\n            instance.iconplus = param.iconplus;\n\n            init_header();\n\n            var printpreview = $('#print_preview');\n            printpreview.find('th').find('img[id*=_thicon]').on('click', toggle_column);\n\n            init_noprints();\n        };\n        return instance;\n\n    }\n);\n"],"names":["define","$","config","log","instance","iconminus","iconplus","init","param","find","each","col","this","attr","split","replace","parent","append","hide","$form","click","init_header","on","e","target","indexOf","show","name","values","not","cfg","method","url","wwwroot","data","sesskey","encodeURI","dataType","beforeSend","info","success","error","ajax","set_user_preference","trigger"],"mappings":";;;;;;AA2BAA,iCACI,CAAC,SAAU,cAAe,aAAa,SAASC,EAAGC,OAAQC,SAWnDC,SAAW,IALC,gBACPC,UAAY,QACZC,SAAW,WAKpBF,SAASG,KAAO,SAASC,OAiGrBJ,SAASC,UAAYG,MAAMH,UAC3BD,SAASE,SAAWE,MAAMF,oBA5FHL,EAAE,kBACRQ,KAAK,MAAMA,KAAK,kBAAkBC,MAAK,eAE5CC,IADOV,EAAEW,MAAMC,KAAK,QACTC,MAAM,KAAK,GACtBT,UAAYD,SAASC,UAAUU,QAAQ,MAAOJ,IAAM,gBAAgBI,QAAQ,MAAOJ,KACnFL,SAAWF,SAASE,SAASS,QAAQ,MAAOJ,IAAM,eAAeI,QAAQ,MAAOJ,KACpFV,EAAEW,MAAMI,SAASC,OAAOZ,WAAWY,OAAOX,UAC1CL,EAAE,IAAMU,IAAM,eAAeO,cAE7BC,MAAQlB,EAAE,mCACdA,EAAE,8BAA8BmB,OAAM,WAAaD,MAAMN,KAAK,SAAU,aACxEZ,EAAE,wBAAwBmB,OAAM,WAAaD,MAAMN,KAAK,SAAU,YAmFtEQ,GAEmBpB,EAAE,kBACRQ,KAAK,MAAMA,KAAK,oBAAoBa,GAAG,kBAnC7BC,OAIfL,KAHAM,OAASvB,EAAEsB,EAAEC,QACbb,IAAMa,OAAOX,KAAK,QAGO,GAFnBW,OAAOX,KAAK,OAEdY,QAAQ,UACZP,MAAO,EACPjB,EAAE,IAAMU,IAAM,gBAAgBO,OAC9BjB,EAAE,IAAMU,IAAM,eAAee,OAC7BzB,EAAE,UAAYU,IAAM,UAAUO,SAE9BA,MAAO,EACPjB,EAAE,IAAMU,IAAM,eAAeO,OAC7BjB,EAAE,IAAMU,IAAM,gBAAgBe,OAC9BzB,EAAE,UAAYU,IAAM,UAAUe,QAEfzB,EAAE,kBACRQ,KAAK,cAAgBE,IAAM,WAAWD,MAC/C,WACQQ,KACAjB,EAAEW,MAAMM,OAERjB,EAAEW,MAAMc,yBArDhBC,KAAO,8BACPC,OAAS,GACb3B,EAAE,0BAA0B4B,IAAI,WAAWnB,MAAK,WAC5CkB,QAAU3B,EAAEW,MAAMC,KAAK,OAAS,WAEhCiB,IAAM,CACNC,OAAQ,MACRC,IAAK9B,OAAO+B,QAAU,4BACtBC,KAAM,SACShC,OAAOiC,aACVC,UAAUT,YACTS,UAAUR,SAEvBS,SAAU,OACVC,WAAY,WACRnC,IAAIoC,KAAK,uBAAyBZ,KAAO,KAAOC,OAAQ,cAE5DY,QAAS,WACLrC,IAAIoC,KAAK,yBAA0B,cAEvCE,MAAO,WACHtC,IAAIsC,MAAM,6BAA8B,eAGhDxC,EAAEyC,KAAKZ,KAiCPa,MArEmB1C,EAAE,kBACRQ,KAAK,MAAMA,KAAK,iBAAiBC,MAAK,eAE3CC,IADOV,EAAEW,MAAMC,KAAK,QACTC,MAAM,KAAK,GAC1Bb,EAAE,IAAMU,IAAM,gBAAgBiC,QAAQ,aA8E3CxC"}